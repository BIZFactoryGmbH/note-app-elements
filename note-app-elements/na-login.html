<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../polymerfire/firebase-auth.html">
<link rel="import" href="../../src/image-carousel.html">
<link rel="import" href="../../src/dialog-html.html">
<dom-module id="na-login">

    <template>

        <firebase-auth id="auth" app-name="obandln" provider="google" signed-in="{{signedIn}}" user="{{user}}">
        </firebase-auth>
        <firebase-auth id="authmobile" app-name="obandln" provider="mobile" app="{{firebase}}" signed-in="{{signedIn}}" user="{{user}}">
        </firebase-auth>
        <firebase-auth id="authfb" app-name="obandln" provider="facebook" signed-in="{{signedIn}}" user="{{user}}">
        </firebase-auth>

        <style include="iron-flex iron-flex-alignment" />
        <style>
            :host {
                /*position: absolute;*/
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 1;
                color: var(--paper-light-green-50);

                @apply --layout;
                @apply --layout-center-center;
            }

            image-carousel,
            image-carousel img,
            image-carousel div {
                /*width: 90vw;
                height: 320px;
                border-radius: 4px;
                padding: 10px;
                border-right: 20px solid #f2f2f2;
                background-color: #f2f2f2;
                border-bottom: 10px solid #f2f2f2;*/
                width: 100vw;
                height: 350px;
                    max-width: 350px;
    margin: 0 auto;
            }

            .paper-carousel-0,
            .carousel {
                max-height: 375px;
                width: 100%;
                background-color: white;
            }

            .paper-carousel-demo {
                color: #444;
            }

            .app-grid {

                overscroll-behavior-y: none;
                overscroll-behavior-x: none;
                max-width: 720px;
                width: 100%;
                margin: 0 auto;
            }

            .login-button,
            #or {
                border-radius: 25px;
                width: 100%;
                margin-top: 15px;
                padding-left: 20px;

            }

            #mobile {
                background: linear-gradient(to right, #0896da, #60d68d);
                height: 41px;
                max-width: 300px;
            }

            #google {
                content: "";
                background-image: url('/images/google-button@3x.png');
                background-position: center;
                background-size: 100%;
                background-repeat: no-repeat;
                height: 41px;
                width: 310px;
                margin: 0;
                padding: 0;
                margin-top: 15px;
            }

            #google>span {

                color: #444;
            }

            #facebook {
                content: "";
                background-image: url('/images/facebook-button@3x.png');
                background-position: center;
                background-size: 100%;
                background-repeat: no-repeat;
                height: 41px;
                width: 310px;
                margin: 0;
                padding: 0;
                margin-top: 15px;
            }

            .padded {
                padding-left: 36px;

                padding-right: 36px;
            }

            .login-button>span,
            #or {
                width: 100%;
                font-family: Rubik;
                font-size: 16px;
                font-weight: 500;
                font-style: normal;
                font-stretch: normal;
                line-height: normal;
                letter-spacing: 0.3px;
                text-align: center;
                color: #ffffff;
            }

            .item.app-grid {
                background-color: white;
                padding-top: 25px;
                text-align: center;
            }

            iron-icon {
                color: white;
            }

            #google>iron-icon {
                color: #444;
            }

            #or,
            #legal {
                color: #444;

                padding-left: 0px;
            }

            #legal {
                font-family: Rubik;
                font-size: 14px;
                font-weight: normal;
                font-style: normal;
                font-stretch: normal;
                line-height: 1.57;
                letter-spacing: 0.3px;
                text-align: center;
                color: #e0e0e0;
                width: 100%;
                margin-top: 25px;
                border-bottom: 10px solid #fff;
            }

            :host([signed-in]) {
                opacity: 0;
                pointer-events: none;
                --app-grid-columns: 1;
                /* 50% the width of the item is equivalent to 2:1 aspect ratio*/
                --app-grid-item-height: 50%;
            }

            .desc {
                color: #838383;
                font-family: Rubik;
                font-weight: 500;
                letter-spacing: 0.3px;
                margin: 0;
                border: 10px solid #f2f2f2;
                background-color: #f2f2f2;
                text-align: center;
                padding-left: 32px;
                padding-right: 33px;
                padding-top: 12px;
                padding-bottom: 12px;
            }
        </style>

        <div class="app-grid" has-aspect-ratio>
            <p class="desc">Discover interesting people at the Wiesn. Click like or x to passâ€¦</p>
            <div class="item carousel">
                <image-carousel aria-label="example carousel">
                    <img src="/images/bg3.png">
                    <!--<img src="https://app-layout-assets.appspot.com/assets/bg2.jpg">
                    <img src="https://app-layout-assets.appspot.com/assets/bg3.jpg">
                    <img src="https://app-layout-assets.appspot.com/assets/bg4.jpg">-->
                </image-carousel>
            </div>
        </div>
        <div class="item app-grid" has-aspect-ratio>
            <div class="item padded">
                <paper-button on-tap="signInMobile" disabled="[[disabled]]" id="mobile" class="login-button">
                    <iron-icon icon="view-module"></iron-icon>
                    <span>MOBILE SIGN UP</span>
                </paper-button>
            </div>
            <div class="item padded">
                <div id="or">OR</div>

            </div>
            <div class="item padded">
                <paper-button on-tap="signIn" disabled="[[disabled]]" id="google" class="login-button">

                </paper-button>
            </div>
            <div class="item padded">
                <paper-button on-tap="signInFb" disabled="[[disabled]]" id="facebook" class="login-button">

                </paper-button>
                </li>
            </div>
            <div class="item padded">
                <div id="legal">
                    By signing up, you agree to our Terms of Use and Privacy Policy. We never post anything in your name on social networks.
                    Imprint
                </div>
            </div>
        </div>
        </div>
        <div id="recaptcha-container"></div>
        <dialog-html style="display: none;"></dialog-html>
    </template>
    <script>

        Polymer({
            is: 'na-login',

            properties: {
                disabled: {
                    type: Boolean,
                    reflectToAttribute: true,
                    value: false
                },

                signedIn: {
                    type: Boolean,
                    reflectToAttribute: true,
                    value: false
                },
                //
                // get notesPath() {
                //
                //   return '/notes/'
                //
                // },

                toEditableId: function (noteId) {
                    return '/notes/' + noteId;
                }

            },
            signIn: function () {
                console.log("sign0");
                // this.fire('sign-in', null, { bubbles: true});
                    this.fire('sign-in', null, { bubble: true });

            },

            signInMobile: function () {

                this.$$('#authmobile').languageCode = 'de';

                /*window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                  'size': 'invisible',
                  'callback': function (response) {
                    // reCAPTCHA solved, allow signInWithPhoneNumber.
                    console.log(response);
                    onSignInSubmit();
                  }
                });
                var appVerifier = window.recaptchaVerifier;
                firebase.auth().signInWithPhoneNumber('01718945969', appVerifier)
                  .then(function (confirmationResult) {
                    // SMS sent. Prompt user to type the code from the message, then sign the
                    // user in with confirmationResult.confirm(code).
                    window.confirmationResult = confirmationResult;
                  }).catch(function (error) {
                  // Error; SMS not sent
                  // ...
                });
                // window.recaptchaVerifier = new this.$$('#authmobile').auth.app.firebase_.auth.RecaptchaVerifier('sign-in-button', {
                //   'size': 'invisible',
                //   'callback': function (response) {
                //     // reCAPTCHA solved, allow signInWithPhoneNumber.
                //     console.log(response);
                //     onSignInSubmit();
                //   }
                // });
                // this.$$('#authmobile').auth.currentUser.linkWithPhoneNumber('01718945969');
                // this.$$('#authmobile').signInWithPopup().then((result) => {*/

                this.fire('sign-in-mobile', {}, { bubble: true });
                // When calling this.fire without previous stuff, the na-login view stays there, so we have to remove it manually
                this.hidden = true;

                // })

            },
            signInFb: function () {

                this.$$('#authfb').signInWithPopup().then((result) => {
                    this.fire('sign-in-fb', { result: result }, { bubble: true });

                })
            }
        });
    </script>
</dom-module>